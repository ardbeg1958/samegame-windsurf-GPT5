# DEVSTORY: Same Game × GPT-5 × Windsurf

最終更新: 2025-08-08

このドキュメントは、初心者でも読みやすい「開発の読み物」です。Vanilla JS だけで Same Game を作り、GPT-5 ベースの AI アシスタント（Cascade）と Windsurf で“対話しながら”進化させていった記録をまとめました。

---

## 1. どんな開発だった？
- **技術スタック**: 単一 `index.html`（HTML+CSS+JS）、外部依存なし。
- **UI/UX**: CSS Grid のボード、スコア、終了モーダル、サイズ切替ドロップダウン。
- **ゲームロジック**: 連結判定（BFS/DFS）、削除→重力落下→列シフト→終了判定の定番フロー。
- **アクセシビリティ**: モーダルに `role="dialog"`、`aria-modal`、`aria-hidden`、`inert`、フォーカス管理を適用。

Windsurf 上でファイルを開き、Cascade に「どこを直す？」「ここを改善して」と会話しながら、その場でコード編集と検証を回すスタイルでした。

---

## 2. 進化のハイライト（時系列）
- **初期版**
  - 盤面生成とクリック削除、重力・列シフトまでを実装。
  - CSS で駒を形と色で表現（色覚多様性に配慮）。

- **バグ修正: リロード時に盤面が出ない**
  - `hasChildNodes()` でコメントノードが引っかかり初期構築がスキップされていた。
  - `childElementCount === 0` に変更し、プレースホルダコメントも削除して安定化。

- **終了モーダルの導入**
  - 画面中央に半透明オーバーレイ＋カードのモーダル。
  - 「新しいゲーム」ボタンでリスタート、ARIA 属性を適切に付与。

- **ドキュメント整備**
  - `REQ.md` と `DESIGN.md` を更新。UI 振る舞い、アニメーション、アクセシビリティ要件を明文化。

- **新機能: 盤面サイズのドロップダウン**
  - 選択肢: 10×10（デフォルト）、10×15、15×10、15×15。
  - `ROWS`/`COLS` を動的に変更し、ボードを再生成。`grid-template-columns` を `COLS` に連動させた。

- **サイズ切替が効かない問題の再修正（核心）**
  - 盤面 DOM を一度しか構築しないロジックが原因で、切替時に列数・セル数が揃わないケースが発生。
  - 対策: `renderBoard()` で毎回 `grid-template-columns` を更新し、`childElementCount !== ROWS*COLS` なら DOM を作り直すよう統一。

- **はみ出し対策: セルサイズの自動調整**
  - 列数が増えると横幅からはみ出す見た目に。
  - `updateGridMetrics()` を追加し、コンテナ幅と `COLS` から `--cell-size` を算出（28〜44pxでクランプ）。`resize` 時にも再計算。

- **アクセシビリティ警告の解消**
  - モーダル非表示時に子要素にフォーカスが残ったまま `aria-hidden` を付けて警告発生。
  - `inert` を活用し、表示時に `overlayBtn.focus()`、非表示時は `overlayBtn.blur()`→ヘッダーの `newGameBtn.focus()` に移動してから隠す、で解決。

---

## 3. うまくいった実装のコア断片
- **DOM 再構築の判断**
  - `if (boardEl.childElementCount !== ROWS * COLS) boardEl.innerHTML = ''` → 必要時のみ再構築。
- **グリッド列の更新**
  - `boardEl.style.gridTemplateColumns = \`repeat(${COLS}, var(--cell-size))\`` を毎回適用。
- **セルサイズの自動計算**
  - 親 `.board-wrap` のパディング/ギャップを考慮して `--cell-size` を設定。画面幅に自然フィット。
- **モーダルの a11y**
  - `role="dialog"`, `aria-modal`, `aria-hidden`, `inert` の組合せ＋フォーカス移動の順序を徹底。

---

## 4. GPT-5（Cascade）× Windsurf で得た学びのツボ
- **対話駆動の“現場デバッグ”**
  - 目視の違和感→Cascade に状況を伝える→該当箇所だけピンポイント修正→そのまま実行まで一気通貫。
- **少しずつ“堅牢化”**
  - 初めはシンプルでも、実際の操作で起きた例外を拾ってロジックを強化（DOM 再構築条件・サイズ算出・フォーカス制御）。
- **ドキュメントも同時進行**
  - 実装に合わせて `REQ.md` と `DESIGN.md` を更新。後から読んだ人にも意図が伝わる。
- **小さくコミット**
  - 変更点を明確にしつつ、小さい塊でコミット。問題が起きたときに戻しやすい。

---

## 5. これから触る人へ
- **まずは読む**: `index.html` の `renderBoard()` と `updateGridMetrics()`、`endGame()`/`newGame()` を眺めると全体がつかめます。
- **動かして遊ぶ**: サイズ切替（10×10/10×15/15×10/15×15）で見た目の変化と挙動を体感。
- **改善アイデア**
  - キーボード操作（矢印移動＋Enter）
  - スコアの永続化（LocalStorage）
  - テーマ切替（ライト/ダーク）
  - 効果音（AudioContext）

---

## 6. 開発を支えたファイル
- `index.html`: すべての実装（UI/JS/CSS）。
- `DESIGN.md`: 設計（データ構造、イベントフロー、描画方針）。
- `REQ.md`: 要件（機能/非機能、受け入れ基準）。

---

## 7. まとめ
小さく作って、実際に操作して違和感を見つけ、AI と会話しながら直す——この繰り返しで、Same Game は**遊べる**品質に育ちました。Windsurf は「編集→実行→修正」のサイクルを超短縮し、Cascade は問題の本質に直線で到達するための“もう一人のシニア開発者”でした。初心者でも、この流れを真似するだけで驚くほど速く前に進めます。楽しんでハックしていきましょう！
