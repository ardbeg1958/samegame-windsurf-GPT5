  - 盤面サイズセレクトで 10×10 / 10×15 / 15×10 / 15×15 を選ぶと、グリッド列数・行数が即座に反映され、新しい局面でゲームが開始される（スコアはリセット）。
  - デフォルトは 10×10 で開始する。
# 要件定義書（Same Game / さめがめ）

最終更新: 2025-08-08
対象リポジトリ: `/Users/sakohiroshi/Dropbox/jobs2025/exp/windsurf/samegame-windsurf-GPT5/`

---

## 1. 目的・背景
- __目的__: クラシックパズルゲーム「さめがめ（Same Game）」をモダンWebブラウザで快適に遊べる形で提供する。
- __背景__: `README.md` に記載のゲーム説明・技術方針（単一HTML、Vanilla JS、CSS3、レスポンシブ、主要ブラウザ対応）を満たす実装を行う。

## 2. 用語定義
- __駒（セル）__: 盤面上の個々のピース。色/形で種類区別。
- __グループ__: 同じ種類で上下左右に隣接して連結した2個以上の集合。
- __削除__: グループをクリック（タップ）して盤面から取り除く操作。
- __重力__: 削除後に上方の駒が下方向へ詰まる挙動。
- __列シフト__: 空列が生じた際に右側列が左へ詰められる挙動。

## 3. スコープ
- __インスコープ__
  - 盤面生成、操作（クリック/タップ）、グループ検出、削除、重力落下、列シフト、スコア計算、ゲーム終了検出、新規ゲーム開始。
  - レスポンシブUI、主要ブラウザ対応、最低限のアニメーション（CSSトランジション）。
- __アウトオブスコープ（将来拡張）__
  - サウンド、BGM、スコア保存/ランキング、カスタムテーマ、統計表示（`README.md` の「今後の拡張予定」参照）。

## 4. 利用者・利用環境
- __対象ユーザー__: カジュアルゲーム利用者（初心者〜上級者）。
- __対応ブラウザ__: Chrome / Firefox / Safari / Edge 最新版相当（`README.md` 完全対応）
- __デバイス__: PC、タブレット、スマートフォン。タッチ/クリック両対応。

## 5. 機能要件（必須）
1. __盤面初期化__
   - ゲーム開始時に N×M のグリッドを生成。
   - 盤面サイズは UI のドロップダウンで選択可能（10×10［デフォルト］/ 10×15 / 15×10 / 15×15）。
   - 4種類の駒をランダム配置（`README.md` の種類: ●(赤)/◆(緑)/★(黄)/■(青)）。色・形は視覚的に区別可能であること。
2. __入力操作__
   - PC: クリック、モバイル: タップでセル選択。
   - 2個以上の同種連結グループのみ削除可能。1個のみは不可。
3. __削除処理__
   - 選択グループを盤面から除去。
   - スコア加算: `削除個数^2 × 10`。
4. __重力落下__
   - 削除後、各列で上の駒が下へ詰まる（空隙なし）。
5. __列シフト__
   - 1列全て空の場合、右隣以降の列を左へ詰める。複数空列にも対応。
6. __ゲーム継続/終了判定__
   - 盤面上に削除可能なグループがある限り継続。
   - なくなった時点でゲーム終了。画面中央にポップアップ（モーダル）を表示し、終了メッセージと「新しいゲーム」ボタンを提示する。
7. __新しいゲーム__
   - 「新しいゲーム」UIでいつでも盤面再生成（スコアはリセット）。
8. __UI/UX__
   - 盤面表示、スコア表示、盤面サイズセレクト（ドロップダウン）、アクション（新しいゲーム）ボタン。
   - セルホバー/タップ時に「削除可能グループ」を視覚強調（例: 枠・明度・スケール）。
   - モバイルでのタップ領域を十分確保。
9. __アニメーション__
   - 削除・落下・列シフトにCSSトランジションで滑らかな視覚効果。
   - 削除時は対象ピースをフェード/縮小で消す（例: `.vanish`）。

## 6. 非機能要件
- __パフォーマンス__: 一般的なスマホでもスムーズ表示（60fpsを目標、最低でも明確なカクつきがないこと）。過度な再計算・再描画を回避（バッチ処理）。
- __互換性__: 主要モダンブラウザで同等挙動。
- __レスポンシブ__: 画面幅に応じてセルサイズ・UIを自動調整。
- __アクセシビリティ__: コントラスト比配慮、色覚多様性に配慮（形状と色の併用）。キーボード操作は任意要件とし、可能なら矢印でセル移動+Enterで削除。
- __構成__: 単一HTMLファイル内で完結（CORS制約回避）、外部ビルド不要。Vanilla JS + CSS3。
- __ライセンス__: MIT（`README.md` 準拠）。

## 7. 画面/UI要件
- __ヘッダー__: タイトル、スコア、操作ボタン（新しいゲーム）。
- __盤面__: グリッド（CSS Grid推奨）。セルはタップしやすい最小サイズを確保（例: 36px以上）。
- __フィードバック__: 削除不可の場合は視覚的反応のみ（エラーは出さない）。終了時は画面中央のモーダルで明確に通知し、同モーダルに「新しいゲーム」ボタンを配置。
- __デバイス最適化__: 横持ち/縦持ちで要素配置が崩れないこと。

## 8. ルール・アルゴリズム要件
- __グループ検出__: 上下左右4近傍で同種セルをBFS/DFSで探索。
- __削除可能条件__: サイズ>=2。
- __スコア__: `size^2 * 10`。合計を表示・加算。
- __落下__: 列ごとに非空セルを下詰め（上を空に）。
- __列シフト__: 左から順に空列を詰める。すべての空列が右端側に集約される。
- __終了判定__: どのセルからもサイズ>=2のグループが得られない。

## 9. データ・状態管理
- __状態__: 盤面配列、スコア、ゲーム状態（プレイ中/終了）。
- __乱数__: ブラウザ標準の`Math.random`で十分。再現性シードは任意。
- __保存__: 本要件では永続化なし（将来拡張でLocalStorageを想定）。

## 10. 品質保証（受け入れ基準）
- __機能テスト__
  - 2個未満の同種連結は削除不可。
  - 2,3,4,5,10個の削除でスコアが 40/90/160/250/1000 加算される。
  - 削除後、同列内で空隙がなくなるまで下詰めされる。
  - 空列発生時に右側列が左へ詰まる。複数空列にも対応。
  - 盤面上にグループが存在しない時点で終了表示。
  - 盤面上にグループが存在しない時点で中央ポップアップ（モーダル）が表示され、文言が適切である。
  - モーダル内「新しいゲーム」ボタンでゲームが再開（盤面/スコアが初期化）され、モーダルが閉じる。
- __互換テスト__: Chrome/Firefox/Safari/Edgeで基本操作が可能。
- __レスポンシブ__: 幅320px相当でも操作可能（スクロールや崩れが致命的でない）。
- __アクセシビリティ__: 色と形の併用表示、コントラスト確保。モーダルは `role="dialog"` 相当、`aria-modal`/`aria-hidden` の切替により状態が把握できる。

## 11. リスク・留意点
- __DOM操作過多__によるパフォーマンス低下 → バッチ更新、必要最小限の再描画。
- __タップ精度__の問題 → セルサイズ、ヒットボックス調整。
- __ブラウザ差異__ → CSS/JSの互換APIに限定。

## 12. 開発体制・成果物
- __成果物__: `index.html`（ゲーム本体）、`README.md`、本 `REQ.md`、（任意）`DESIGN.md`。
- __アーキテクチャ__: 単一HTMLにHTML/CSS/JSを内包。

## 13. マイルストーン（目安）
1. 骨組み実装（盤面表示・初期化・入力）
2. グループ検出・削除・スコア
3. 重力・列シフト・終了判定
4. UI洗練・レスポンシブ・アニメーション
5. 互換/端末テスト・調整、ドキュメント整備

## 14. 変更管理
- 要件変更は本ファイルの更新履歴で管理。影響範囲を`DESIGN.md`に反映。

---

本要件定義は `README.md` を一次情報とし、実装の指針となる具体条件を明文化したものです。今後の拡張（サウンド、スコア保存等）は別途要件化して段階的に実装します。
